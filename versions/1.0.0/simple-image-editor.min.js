/*! simple-image-editor 1.0.0 by: Sam North. Built on 09-20-2018 */
function simpleImageEditor(e){var l,h,r,u,v,g,a,s,m,b,d,c,o,p=e||{},f={pencil:0,line:1,arrow:2,eraser:3,square:4,circle:5},w=p.defaultDrawingThickness||6,y=!1,E=void 0===p.showDownloadButton||p.showDownloadButton,I=void 0!==p.showSaveButton&&p.showSaveButton,x=0;function L(e){Y(e.src),t(e.src)}function t(e){var t;document.getElementById("sie-hp").setAttribute("src",e),(t=document.getElementById("sie-c")).classList.remove("sie-h"),t.classList.add("sie-ib"),x=0,g.clearRect(0,0,v.width,v.height),h.clearRect(0,0,l.width,l.height),function(){document.getElementById("sie-rbr").addEventListener("click",T,!1),document.getElementById("sie-rbl").addEventListener("click",R,!1);var e=document.getElementById("sie-lw");e.value=w,e.addEventListener("change",K,!1),W();var t=document.getElementById("sie-cp");t.addEventListener("change",A,!1),t.value=p.defaultDrawingColor||"#FF0000",A(),l.addEventListener("mousedown",M,!1),l.addEventListener("mousemove",N,!1),l.addEventListener("mouseup",S,!1),l.addEventListener("mouseout",S,!1);var i=document.getElementById("sie-sb");I?i.addEventListener("click",O,!1):i.classList.add("sie-h");var n=document.getElementById("sie-d");E?n.addEventListener("click",F,!1):n.classList.add("sie-h");var a=document.getElementsByClassName("sie-dc");for(var s in a)if(a.hasOwnProperty(s)){var d=a[s];d.addEventListener("click",U,!1)}p.defaultDrawingControl&&""!==p.defaultDrawingControl?q(p.defaultDrawingControl):document.getElementById("sie-c").getElementsByClassName("sie-dc")[0].click()}()}function n(e){t(e.target.result)}function X(){var e=document.getElementById("sie-hp"),t=e.width/v.width,i=v.width,n=v.height;e.width>=e.height?n=e.height/t:(t=e.height/v.height,i=e.width/t),g.drawImage(e,0,0,i,n)}function Y(e){if(e&&""!==e&&0!==e.indexOf("blob:")){var t=e.lastIndexOf("\\");-1===t&&(t=e.lastIndexOf("/"));var i=(c=-1===t?e:e.substring(t+1)).lastIndexOf(".");-1!=i&&(d=c.substring(0,i))}else d=c="edited"}function B(){b={pX:0,pY:0,X:0,Y:0,beginX:0,beginY:0,endX:0,endY:0}}function i(e){g.save();var t=90*e,i=(x=(x+t)%360)*Math.PI/180;g.clearRect(0,0,v.width,v.height);var n=Math.abs(x),a=90===x||180===n||-270===x?l.width:0,s=180===n||270===x||-90===x?l.height:0;g.translate(a,s),g.rotate(i),X(),g.rotate(-i),g.translate(-a,s),g.restore();var d=t*Math.PI/180,c=0<e?r.width:0,o=0<e?0:r.height;u.translate(c,o),u.rotate(d),u.clearRect(0,0,r.width,r.height),u.drawImage(l,0,0),u.rotate(-d),u.translate(-c,-o),u.restore(),h.clearRect(0,0,l.width,l.height),h.drawImage(r,0,0),u.clearRect(0,0,r.width,r.height)}function T(e){i(1)}function R(e){i(-1)}function P(e){return e.clientX-l.getBoundingClientRect().left}function C(e){return e.clientY-l.getBoundingClientRect().top}function _(e){b.pX=b.X,b.pY=b.Y,b.X=P(e),b.Y=C(e)}function D(){var e=b.endX-b.beginX,t=.1*e,i=.07*e,n=b.endX-t,a=b.endX-i,s=b.endY-b.beginY,d=.1*s,c=.07*s,o=b.endY-d,l=b.endY-c,r=b.endY-b.beginY,u=b.endX-b.beginX,v=function(e,t,i,n){var a,s,d,c;if(0===n)a=e+i,d=e-i,c=s=t;else if(isFinite(n)){var o=i/Math.sqrt(1+Math.pow(n,2)),l=n*o;a=e+o,s=t+l,d=e-o,c=t-l}else s=t+i,d=a=e,c=t-i;return{a:{x:a,y:s},b:{x:d,y:c}}}(n,o,2.5*w,u/r*-1);h.beginPath(),h.moveTo(b.beginX,b.beginY),h.lineTo(a,l),h.strokeStyle=m,h.lineWidth=w,h.stroke(),h.closePath(),h.beginPath(),h.moveTo(v.a.x,v.a.y),h.lineTo(v.b.x,v.b.y),h.lineTo(b.endX,b.endY),h.fillStyle=m,h.fill(),h.closePath()}function M(e){B(),b.beginX=P(e),b.beginY=C(e),_(e),y=!0}function N(e){var t;y&&(_(e),o===f.pencil?(h.beginPath(),h.moveTo(b.pX,b.pY),h.lineTo(b.X,b.Y),h.strokeStyle=m,h.lineWidth=w,h.stroke(),h.closePath()):o===f.eraser&&(t=3*w,h.clearRect(b.X-w,b.Y-w,t,t)))}function S(e){var t,i,n,a,s;b.endX=P(e),b.endY=C(e),y&&o===f.line?(h.beginPath(),h.moveTo(b.beginX,b.beginY),h.lineTo(b.endX,b.endY),h.strokeStyle=m,h.lineWidth=w,h.stroke(),h.closePath()):y&&o===f.arrow?D():y&&o===f.square?(h.beginPath(),h.moveTo(b.beginX,b.beginY),h.lineTo(b.beginX,b.endY),h.lineTo(b.endX,b.endY),h.lineTo(b.endX,b.beginY),h.lineTo(b.beginX,b.beginY),h.strokeStyle=m,h.lineWidth=w,h.stroke(),h.closePath()):y&&o===f.circle&&(t=.5*(b.endX-b.beginX),i=b.endX-t,n=.5*(b.endY-b.beginY),a=b.endY-n,s=Math.sqrt(Math.pow(b.endX-i,2)+Math.pow(b.endY-a,2)),h.beginPath(),h.arc(i,a,s,0,2*Math.PI),h.strokeStyle=m,h.lineWidth=w,h.stroke(),h.closePath()),y=!1,B()}function A(){var e=document.getElementById("sie-cp");m=e.value}function O(){var e=document.getElementById("sie-hsl"),t=p.exportImageFileType||"png",i=decodeURI(d+"."+t);s.clearRect(0,0,a.width,a.height),s.drawImage(v,0,0),s.drawImage(l,0,0);var n=a.toDataURL("image/"+t).replace("image/"+t,"image/octet-stream");return e.setAttribute("download",i),e.setAttribute("href",n),{originalFileName:decodeURI(c),base64Image:n,editedFileName:i}}function F(){O(),document.getElementById("sie-hsl").click()}function U(e){q(e.target.dataset.value)}function q(e){var t=e;isNaN(t)&&(t=f[e]),o=Number(t);var i=document.getElementsByClassName("sie-dc");for(var n in i)if(i.hasOwnProperty(n)){var a=i[n];a.classList.remove("sie-pc"),a.removeAttribute("disabled"),Number(a.dataset.value)===o&&(a.setAttribute("disabled","disabled"),a.classList.add("sie-pc"))}}function W(){document.getElementById("sie-lwd").textContent=w}function K(e){w=Number(e.target.value),W()}return document.getElementById(p.containerId).innerHTML='<style>#sie-cnv{position:relative}#sie-i-cnv{position:absolute}#sie-h-cnv{display:none;position:relative}#sie-f-cnv{display:none;position:relative}.sie-cnt{overflow:hidden;margin-bottom:10px;margin-top:10px;text-align:center;border:1px #000 solid}.sie-cnt>img{width:96%;position:absolute;display:block;top:0;left:6px}#sie-cnv:hover{cursor:cell}.sie-ib{display:inline-block}.sie-cc button{width:80px}.sie-h{display:none!important}#sie-cnt{display:hidden}#sie-c{vertical-align:top;margin-left:10px;min-width:180px;width:180px}#sie-c .sie-cc{margin-top:10px;margin-bottom:10px}.sie-pc{color:#fff;background-color:#494a4f;border:#767676 2px solid}#sie-lw{width:70px}.sie-bc{margin-right:10px;width:80px}</style><input id="sie-fu" type="file"><span>"ctrl + v" to paste</span><br><div id="sie"><canvas id="sie-i-cnv" class="sie-cnt"></canvas><canvas id="sie-cnv" class="sie-cnt"></canvas><canvas id="sie-h-cnv" class="sie-cnt"></canvas><canvas id="sie-f-cnv" class="sie-cnt"></canvas><div id="sie-cnt" class="sie-cnt sie-h"><img id="sie-hp"> <a id="sie-hsl"></a></div><div id="sie-c" class="sie-h"><div class="sie-bc sie-ib"><div class="sie-cc"><button id="sie-rbl">&lt;- Rotate</button></div></div><div class="sie-bc sie-ib"><div class="sie-cc"><button id="sie-rbr">-&gt; Rotate</button></div></div><hr><div class="sie-cc"><input id="sie-cp" type="color"> <span>Select color</span></div><div class="sie-cc"><input id="sie-lw" min="1" max="10" type="range"> <span>Line width: <span id="sie-lwd"></span></span></div><div class="sie-ib sie-bc"><div class="sie-cc"><button data-value="3" class="sie-dc">Eraser</button></div><div class="sie-cc"><button data-value="0" class="sie-dc">Pencil</button></div><div class="sie-cc"><button data-value="1" class="sie-dc">Line</button></div></div><div class="sie-ib sie-bc"><div class="sie-cc"><button data-value="2" class="sie-dc">Arrow</button></div><div class="sie-cc"><button data-value="4" class="sie-dc">Square</button></div><div class="sie-cc"><button data-value="5" class="sie-dc">Circle</button></div></div><hr><div class="sie-cc"><div class="sie-ib sie-bc"><button id="sie-sb">Save</button></div><div class="sie-ib sie-bc"><button id="sie-d">Download</button></div></div></div></div>',B(),document.getElementById("sie-fu").addEventListener("input",function(e){var t=e.target.files[0],i=new FileReader;i.onload=n,i.readAsDataURL(t),Y(t.name)},!1),document.getElementById("sie-hp").addEventListener("load",X,!1),(l=document.getElementById("sie-cnv")).width=p.width||300,l.height=p.height||l.width,h=l.getContext("2d"),(r=document.getElementById("sie-h-cnv")).width=p.width||300,r.height=p.height||r.width,u=r.getContext("2d"),(v=document.getElementById("sie-i-cnv")).width=p.width||300,v.height=p.height||v.width,g=v.getContext("2d"),(a=document.getElementById("sie-f-cnv")).width=p.width||300,a.height=p.height||a.width,s=a.getContext("2d"),new function(){var s,d,i=this,n=!1,t=!1;document.addEventListener("keydown",function(e){i.on_keyboard_action(e)},!1),document.addEventListener("keyup",function(e){i.on_keyboardup_action(e)},!1),document.addEventListener("paste",function(e){i.paste_auto(e)},!1),this.init=function(){(d=document.createElement("div")).setAttribute("id","paste_ff"),d.setAttribute("contenteditable",""),d.style.cssText="opacity:0;position:fixed;top:0px;left:0px;width:10px;margin-left:-20px;",document.body.appendChild(d);var e=new MutationObserver(function(e){e.forEach(function(e){if(!0===s||0==n||"childList"!=e.type)return!0;1==e.addedNodes.length&&(null!=e.addedNodes[0].src&&i.paste_createImage(e.addedNodes[0].src),setTimeout(function(){d.innerHTML=""},20))})}),t=document.getElementById("paste_ff");e.observe(t,{attributes:!0,childList:!0,characterData:!0})}(),this.paste_auto=function(e){if(s=!1,null!=d&&(d.innerHTML=""),e.clipboardData){var t=e.clipboardData.items;if(t){s=!0;for(var i=0;i<t.length;i++)if(-1!==t[i].type.indexOf("image")){var n=t[i].getAsFile(),a=(window.URL||window.webkitURL).createObjectURL(n);this.paste_createImage(a)}e.preventDefault()}}},this.on_keyboard_action=function(e){if(k=e.keyCode,(17==k||e.metaKey||e.ctrlKey)&&0==n&&(n=!0),86==k){if(null!=document.activeElement&&"text"==document.activeElement.type)return!1;1==n&&null!=d&&d.focus()}},this.on_keyboardup_action=function(e){0==e.ctrlKey&&1==n?n=!1:0==e.metaKey&&1==t&&(n=t=!1)},this.paste_createImage=function(e){var t=new Image;t.onload=function(){L(t)},t.src=e}},{saveImage:O,loadImage:L}}