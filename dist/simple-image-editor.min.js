/*! simple-image-editor 1.0.0 by: Sam North. Built on 12-06-2018 */
function simpleImageEditor(){var u;if(1===arguments.length&&"string"==typeof arguments[0])u={containerId:arguments[0]};else{for(var e=0;e<arguments.length;e++)if("object"==typeof arguments[e]){u=arguments[e];break}u=u||{};for(var t=0;t<arguments.length;t++)if("string"==typeof arguments[t]){u.containerId=arguments[t];break}}var g,b,p,m,f,w,v,h,y,E,I,x,X,Y,L,B,s,r={pencil:0,line:1,arrow:2,eraser:3,square:4,circle:5},C=u.defaultDrawingThickness||6,d=!1,T=void 0===u.showDownloadButton||u.showDownloadButton,R=void 0!==u.showSaveButton&&u.showSaveButton,D=0;function a(e){l(e.src),i(e.src)}function i(e){document.getElementById("sie-hp").setAttribute("src",e),o(void 0!==u.hideAllControls&&!0===u.hideAllControls?"hide":"show"),D=0,w.clearRect(0,0,f.width,f.height),b.clearRect(0,0,g.width,g.height),function(){document.getElementById("sie-rbr").addEventListener("click",_,!1),document.getElementById("sie-rbl").addEventListener("click",A,!1);var e=document.getElementById("sie-lw");e.value=C,e.addEventListener("change",Z,!1),V(C,!0);var t=document.getElementById("sie-cp"),i=document.getElementById("sie-cps");if(function(){var e=document.createElement("input");e.setAttribute("type","color");var t="text"!==e.type;return t&&(e.value=":)",t=":)"!=e.value),t}())t.addEventListener("change",H,!1),t.value=u.defaultDrawingColor||"#FF0000",i.style.display="none",t.style.display="initial",H();else{if(i.addEventListener("change",$,!1),i.value="red",u.defaultDrawingColor&&""!==u.defaultDrawingColor)for(var n=0;n<i.options.length;n++){var a=i.options[n];if(a.value===u.defaultDrawingColor){i.value=a.value;break}}t.style.display="none",i.style.display="initial",j()}g.addEventListener("mousedown",q,!1),g.addEventListener("mousemove",W,!1),g.addEventListener("mouseup",K,!1),g.addEventListener("mouseout",K,!1);var o=document.getElementById("sie-sb");R?o.addEventListener("click",z,!1):o.parentElement.classList.add("sie-h");var s=document.getElementById("sie-d");T?s.addEventListener("click",G,!1):s.classList.add("sie-h");var d=document.getElementsByClassName("sie-dc");for(var l in d)if(d.hasOwnProperty(l)){var c=d[l];c.addEventListener("click",J,!1)}Q(u.defaultDrawingControl&&""!==u.defaultDrawingControl?u.defaultDrawingControl:r.pencil)}()}function n(e){i(e.target.result)}function P(e){var t=document.getElementById("sie-hp"),i=t.width/f.width,n=f.width,a=f.height;t.width>=t.height?a=t.height/i:(i=t.height/f.height,n=t.width/i),w.drawImage(t,0,0,n,a),void 0!==e&&!0===e&&(Y=X=0,I=n,x=a)}function o(e){var t=e,i=document.getElementById("sie-c"),n="sie-h";void 0===e&&(t=i.classList.contains(n)?"show":"hide");var a="show"===t?"sie-ib":n,o="show"===t?n:"sie-ib";i.classList.remove(o),i.classList.add(a)}function l(e){if(e&&""!==e&&0!==e.indexOf("blob:")){var t=e.lastIndexOf("\\");-1===t&&(t=e.lastIndexOf("/"));var i=(B=-1===t?e:e.substring(t+1)).lastIndexOf(".");-1!=i&&(L=B.substring(0,i))}else L=B="edited"}function c(){E={pX:0,pY:0,X:0,Y:0,beginX:0,beginY:0,endX:0,endY:0}}function M(e){var t,i,n,a,o;t=e,i=Math.ceil(X),n=Math.ceil(Y),a=Math.ceil(I),o=Math.ceil(x),x=a,I=o,t<(Y=X=0)?(0<i&&(x=a-i),0<n&&(X=n),a<g.width&&(Y=g.height-a,x=Y+a),I=o):(0<n&&(I=o-n),0<i&&(Y=i),o<g.height&&(X=g.width-o,I=X+o),x=a),w.save();var s=90*e,d=(D=(D+s)%360)*Math.PI/180;w.clearRect(0,0,f.width,f.height);var l=Math.abs(D),c=90===D||180===l||-270===D?g.width:0,r=180===l||270===D||-90===D?g.height:0;w.translate(c,r),w.rotate(d),P(!1),w.rotate(-d),w.translate(-c,r),w.restore();var u=s*Math.PI/180,v=0<e?p.width:0,h=0<e?0:p.height;m.translate(v,h),m.rotate(u),m.clearRect(0,0,p.width,p.height),m.drawImage(g,0,0),m.rotate(-u),m.translate(-v,-h),m.restore(),b.clearRect(0,0,g.width,g.height),b.drawImage(p,0,0),m.clearRect(0,0,p.width,p.height)}function _(e){M(1)}function A(e){M(-1)}function N(e){return e.clientX-g.getBoundingClientRect().left}function S(e){return e.clientY-g.getBoundingClientRect().top}function F(e){E.pX=E.X,E.pY=E.Y,E.X=N(e),E.Y=S(e)}function O(e,t){I<e&&(I=e),x<t&&(x=t),e<X&&(X=e),t<Y&&(Y=t)}function U(){var e=E.endX-E.beginX,t=.1*e,i=.07*e,n=E.endX-t,a=E.endX-i,o=E.endY-E.beginY,s=.1*o,d=.07*o,l=E.endY-s,c=E.endY-d,r=E.endY-E.beginY,u=E.endX-E.beginX,v=function(e,t,i,n){var a,o,s,d;if(0===n)a=e+i,s=e-i,d=o=t;else if(isFinite(n)){var l=i/Math.sqrt(1+Math.pow(n,2)),c=n*l;a=e+l,o=t+c,s=e-l,d=t-c}else o=t+i,s=a=e,d=t-i;return{a:{x:a,y:o},b:{x:s,y:d}}}(n,l,2.5*C,u/r*-1);b.beginPath(),b.moveTo(E.beginX,E.beginY),b.lineTo(a,c),b.strokeStyle=y,b.lineWidth=C,b.stroke(),b.closePath(),b.beginPath(),b.moveTo(v.a.x,v.a.y),b.lineTo(v.b.x,v.b.y),b.lineTo(E.endX,E.endY),b.fillStyle=y,b.fill(),b.closePath(),O(E.beginX,E.beginY),O(E.endX,E.endY)}function q(e){c(),E.beginX=N(e),E.beginY=S(e),F(e),d=!0}function W(e){var t;d&&(F(e),s===r.pencil?(b.beginPath(),b.moveTo(E.pX,E.pY),b.lineTo(E.X,E.Y),b.strokeStyle=y,b.lineWidth=C,b.stroke(),b.closePath(),O(E.X,E.Y)):s===r.eraser&&(t=3*C,b.clearRect(E.X-C,E.Y-C,t,t)))}function K(e){var t,i,n,a,o;E.endX=N(e),E.endY=S(e),d&&s===r.line?(b.beginPath(),b.moveTo(E.beginX,E.beginY),b.lineTo(E.endX,E.endY),b.strokeStyle=y,b.lineWidth=C,b.stroke(),b.closePath(),O(E.beginX,E.beginY),O(E.endX,E.endY)):d&&s===r.arrow?U():d&&s===r.square?(b.beginPath(),b.moveTo(E.beginX,E.beginY),b.lineTo(E.beginX,E.endY),b.lineTo(E.endX,E.endY),b.lineTo(E.endX,E.beginY),b.lineTo(E.beginX,E.beginY),b.strokeStyle=y,b.lineWidth=C,b.stroke(),b.closePath(),O(E.beginX,E.beginY),O(E.endX,E.endY)):d&&s===r.circle&&(t=.5*(E.endX-E.beginX),i=E.endX-t,n=.5*(E.endY-E.beginY),a=E.endY-n,o=Math.sqrt(Math.pow(E.endX-i,2)+Math.pow(E.endY-a,2)),b.beginPath(),b.arc(i,a,o,0,2*Math.PI),b.strokeStyle=y,b.lineWidth=C,b.stroke(),b.closePath(),O(i+o,a+o),O(i-o,a-o)),d=!1,c()}function H(e){var t=document.getElementById("sie-cp");void 0===e||""===e||e instanceof Event||(t.value=e),y=t.value}function j(e){var t=document.getElementById("sie-cps");void 0===e||""===e||e instanceof Event||(t.value=e);for(var i=0;i<t.options.length;i++){var n=t.options[i];if(n.value===t.value){t.style.backgroundColor=n.style.backgroundColor,t.style.color=n.style.color;break}}H(t.value)}function $(e){j(e.target.value)}function z(){for(var e=document.getElementById("sie-hsl"),t=u.exportImageFileType||"png",i=decodeURI(L+"."+t),n=["#","%","&","{","}","\\",">","<","*","?","/"," ","$","!","'",'"',":","@","+"],a=0;a<n.length;a++){var o=n[a];i=i.replace(o,"")}h.clearRect(0,0,v.width,v.height),h.drawImage(f,0,0),h.drawImage(g,0,0);var s=document.createElement("canvas"),d=I-X,l=x-Y;s.width=d,s.height=l,s.getContext("2d").drawImage(v,X,Y,d,l,0,0,d,l);var c,r=s.toDataURL("image/"+t).replace("image/"+t,"image/octet-stream");return s.msToBlob&&(c=s.msToBlob()),e.setAttribute("download",i),e.setAttribute("href",r),{originalFileName:decodeURI(B),base64Image:r,blob:c,editedFileName:i}}function G(){var e=z();e.blob?window.navigator.msSaveBlob(e.blob,e.editedFileName):document.getElementById("sie-hsl").click()}function J(e){Q(e.target.dataset.value)}function Q(e){var t=e;isNaN(t)&&(t=r[e]),s=Number(t);var i=document.getElementsByClassName("sie-dc");for(var n in i)if(i.hasOwnProperty(n)){var a=i[n];a.classList.remove("sie-pc"),a.removeAttribute("disabled"),Number(a.dataset.value)===s&&(a.setAttribute("disabled","disabled"),a.classList.add("sie-pc"))}}function V(e,t){C=Number(e);var i=document.getElementById("sie-lwd");t&&(document.getElementById("sie-lw").value=C);i.textContent=C}function Z(e){V(e.target.value)}return document.getElementById(u.containerId).innerHTML='<style>#sie-cnv{position:relative}#sie-i-cnv{position:absolute}#sie-h-cnv{display:none;position:relative}#sie-f-cnv{display:none;position:relative}.sie-cnt{overflow:hidden;margin-bottom:10px;margin-top:10px;text-align:center;border:1px #000 solid}.sie-cnt>img{width:96%;position:absolute;display:block;top:0;left:6px}#sie-cnv:hover{cursor:cell}.sie-ib{display:inline-block}.sie-cc button{width:80px}.sie-h{display:none!important}#sie-cnt{display:hidden}#sie-c{vertical-align:top;margin-left:10px;min-width:180px;width:180px}#sie-c .sie-cc{margin-top:10px;margin-bottom:10px}.sie-pc{color:#fff;background-color:#494a4f;border:#767676 2px solid}#sie-lw{width:70px}.sie-bc{margin-right:10px;width:80px}#sie-cps{width:75px}</style><input id="sie-fu" type="file"><span>"ctrl + v" to paste</span><br><div id="sie"><canvas id="sie-i-cnv" class="sie-cnt"></canvas><canvas id="sie-cnv" class="sie-cnt"></canvas><canvas id="sie-h-cnv" class="sie-cnt"></canvas><canvas id="sie-f-cnv" class="sie-cnt"></canvas><div id="sie-cnt" class="sie-cnt sie-h"><img id="sie-hp"> <a id="sie-hsl"></a></div><div id="sie-c" class="sie-h"><div class="sie-bc sie-ib"><div class="sie-cc"><button id="sie-rbl">&lt;- Rotate</button></div></div><div class="sie-bc sie-ib"><div class="sie-cc"><button id="sie-rbr">-&gt; Rotate</button></div></div><hr><div class="sie-cc"><input id="sie-cp" type="color"> <select id="sie-cps"><option style="background-color: black; color: white;" value="black">black</option><option style="background-color: blue; color: white;" value="blue">blue</option><option style="background-color: green; color: white;" value="green">green</option><option style="background-color: orange" value="orange">orange</option><option style="background-color: purple; color: white;" value="purple">purple</option><option style="background-color: red; color: white;" value="red">red</option><option style="background-color: white; color: black;" value="white">white</option><option style="background-color: yellow" value="yellow">yellow</option></select> <span>Select color</span></div><div class="sie-cc"><input id="sie-lw" min="1" max="10" type="range"> <span>Line width: <span id="sie-lwd"></span></span></div><div class="sie-ib sie-bc"><div class="sie-cc"><button data-value="3" class="sie-dc">Eraser</button></div><div class="sie-cc"><button data-value="0" class="sie-dc">Pencil</button></div><div class="sie-cc"><button data-value="1" class="sie-dc">Line</button></div></div><div class="sie-ib sie-bc"><div class="sie-cc"><button data-value="2" class="sie-dc">Arrow</button></div><div class="sie-cc"><button data-value="4" class="sie-dc">Square</button></div><div class="sie-cc"><button data-value="5" class="sie-dc">Circle</button></div></div><hr><div class="sie-cc"><div class="sie-ib sie-bc"><button id="sie-sb">Save</button></div><div class="sie-ib sie-bc"><button id="sie-d">Download</button></div></div></div></div>',c(),document.getElementById("sie-fu").addEventListener("input",function(e){var t=e.target.files[0],i=new FileReader;i.onload=n,i.readAsDataURL(t),l(t.name)},!1),document.getElementById("sie-hp").addEventListener("load",function(){P(!0)},!1),(g=document.getElementById("sie-cnv")).width=u.width||300,g.height=g.width,b=g.getContext("2d"),(p=document.getElementById("sie-h-cnv")).width=u.width||300,p.height=p.width,m=p.getContext("2d"),(f=document.getElementById("sie-i-cnv")).width=u.width||300,f.height=f.width,w=f.getContext("2d"),(v=document.getElementById("sie-f-cnv")).width=u.width||300,v.height=v.width,h=v.getContext("2d"),new function(){var o,s,i=this,n=!1,t=!1;document.addEventListener("keydown",function(e){i.on_keyboard_action(e)},!1),document.addEventListener("keyup",function(e){i.on_keyboardup_action(e)},!1),document.addEventListener("paste",function(e){i.paste_auto(e)},!1),this.init=function(){(s=document.createElement("div")).setAttribute("id","paste_ff"),s.setAttribute("contenteditable",""),s.style.cssText="opacity:0;position:fixed;top:0px;left:0px;width:10px;margin-left:-20px;",document.body.appendChild(s);var e=new MutationObserver(function(e){e.forEach(function(e){if(!0===o||0==n||"childList"!=e.type)return!0;1==e.addedNodes.length&&(null!=e.addedNodes[0].src&&i.paste_createImage(e.addedNodes[0].src),setTimeout(function(){s.innerHTML=""},20))})}),t=document.getElementById("paste_ff");e.observe(t,{attributes:!0,childList:!0,characterData:!0})}(),this.paste_auto=function(e){if(o=!1,null!=s&&(s.innerHTML=""),e.clipboardData){var t=e.clipboardData.items;if(t){o=!0;for(var i=0;i<t.length;i++)if(-1!==t[i].type.indexOf("image")){var n=t[i].getAsFile(),a=(window.URL||window.webkitURL).createObjectURL(n);this.paste_createImage(a)}e.preventDefault()}}},this.on_keyboard_action=function(e){if(k=e.keyCode,(17==k||e.metaKey||e.ctrlKey)&&0==n&&(n=!0),86==k){if(null!=document.activeElement&&"text"==document.activeElement.type)return!1;1==n&&null!=s&&s.focus()}},this.on_keyboardup_action=function(e){0==e.ctrlKey&&1==n?n=!1:0==e.metaKey&&1==t&&(n=t=!1)},this.paste_createImage=function(e){var t=new Image;t.onload=function(){a(t)},t.src=e}},{saveImage:z,loadImage:a,rotateRight:function(){M(1)},rotateLeft:function(){M(-1)},setColor:H,setDrawingThickness:function(e){V(e,!0)},setDrawingControl:Q,toggleControls:o}}